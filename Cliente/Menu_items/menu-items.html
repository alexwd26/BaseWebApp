<section class="menu-items">
  <header class="menu-header">
    <h1 class="menu-title">Menu Items</h1>
    <div class="loading-indicator" aria-live="polite">
      <div class="spinner"></div>
      <span class="loading-text">Loading menu...</span>
    </div>
  </header>

  <div class="error-message" role="alert" aria-live="assertive" hidden>
    </div>

  <div class="menu-grid">
    </div>
</section>

<script>
  console.log('Script de menu carregado!'); // Verificação se o script está sendo executado

  const menuGrid = document.querySelector('.menu-grid');
  const loadingIndicator = document.querySelector('.loading-indicator');
  const errorMessageDiv = document.querySelector('.error-message');

  const state = {
    items: [],
    loading: true,
    error: null,
    loadItems: async function loadItems() {
      try {
        const response = await fetch("http://15.228.148.198:8000/api/menus/");
        if (!response.ok) throw new Error("Failed to load menu items");
        const data = await response.json();
        state.items = data;
        state.loading = false;
        state.error = null; // Limpa qualquer erro anterior
        renderMenuItems();
      } catch (err) {
        state.error = "Failed to load menu items. Please try again.";
        state.loading = false;
        console.error("Erro ao carregar o menu:", err);
        displayError();
      } finally {
        hideLoading(); // Garante que o loading seja ocultado
      }
    },
  };

  function renderMenuItems() {
    menuGrid.innerHTML = ''; // Limpa o conteúdo anterior do grid

    state.items.forEach(item => {
      const menuItemCard = document.createElement('article');
      menuItemCard.classList.add('menu-card');

      const imageContainer = document.createElement('div');
      imageContainer.classList.add('image-container');

      const img = document.createElement('img');
      img.src = `https://placehold.co/400x300?text=${encodeURIComponent(item.name)}`; // Usando o nome do item como texto placeholder
      img.alt = item.name;
      img.classList.add('menu-image');

      const favoriteButton = document.createElement('button');
      favoriteButton.classList.add('favorite-button');
      favoriteButton.setAttribute('aria-label', 'Add to favorites');
      favoriteButton.innerHTML = `
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M3.59835 5.26485C2.13388 6.72932 2.13388 9.10369 3.59835 10.5682L10 16.9698L16.4017 10.5682C17.8661 9.10369 17.8661 6.72932 16.4016 5.26485C14.9372 3.80039 12.5628 3.80039 11.0983 5.26485L10 6.36325L8.90165 5.26485C7.43718 3.80039 5.06282 3.80039 3.59835 5.26485Z"
                stroke="#F14141" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
      `;

      imageContainer.appendChild(img);
      imageContainer.appendChild(favoriteButton);

      const cardContent = document.createElement('div');
      cardContent.classList.add('card-content');

      const itemName = document.createElement('h3');
      itemName.classList.add('item-name');
      itemName.textContent = item.name;

      const itemDetails = document.createElement('div');
      itemDetails.classList.add('item-details');
      itemDetails.innerHTML = `
        <div class="metrics">
          <div class="rating">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M7.52447 1.46352C7.67415 1.00287 8.32585 1.00287 8.47553 1.46353L9.68386 5.18237C9.75079 5.38838 9.94277 5.52786 10.1594 5.52786H14.0696C14.554 5.52786 14.7554 6.14767 14.3635 6.43237L11.2001 8.73075C11.0248 8.85807 10.9515 9.08375 11.0184 9.28976L12.2268 13.0086C12.3764 13.4693 11.8492 13.8523 11.4573 13.5676L8.29389 11.2693C8.11865 11.1419 7.88135 11.1419 7.70611 11.2693L4.54267 13.5676C4.15081 13.8523 3.62357 13.4693 3.77325 13.0086L4.98157 9.28976C5.04851 9.08375 4.97518 8.85807 4.79994 8.73075L1.6365 6.43237C1.24464 6.14767 1.44603 5.52786 1.93039 5.52786H5.84062C6.05723 5.52786 6.24921 5.38838 6.31614 5.18237L7.52447 1.46352Z"
                    fill="#FE8C00"></path>
            </svg>
            <span class="rating-value">4.9</span>
          </div>
          <div class="distance">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
              <path d="M10.2999 9.7165C9.87955 10.1368 9.10635 10.91 8.41402 11.6023C7.63298 12.3834 6.367 12.3833 5.58595 11.6022C4.90703 10.9233 4.14601 10.1623 3.70021 9.7165C1.87776 7.89405 1.87776 4.93928 3.70021 3.11684C5.52266 1.29439 8.47743 1.29439 10.2999 3.11684C12.1223 4.93928 12.1223 7.89405 10.2999 9.7165Z"
                    stroke="#FE8C00" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <span class="distance-value">190m</span>
          </div>
        </div>
        <span class="price">$${item.price.toFixed(2)}</span>
      `;

      cardContent.appendChild(itemName);
      cardContent.appendChild(itemDetails);

      menuItemCard.appendChild(imageContainer);
      menuItemCard.appendChild(cardContent);

      menuGrid.appendChild(menuItemCard);
    });
  }

  function displayError() {
    errorMessageDiv.textContent = state.error;
    errorMessageDiv.removeAttribute('hidden');
  }

  function hideLoading() {
    loadingIndicator.style.display = 'none';
  }

  // Iniciar o carregamento dos itens quando a página carregar
  state.loadItems();
</script>